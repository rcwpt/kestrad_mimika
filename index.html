<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografis Kestradis Mimika 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Palette: Vibrant Medical (Teal, Deep Blue, Orange) -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0FDFA; /* Light Teal bg */
            color: #1F2937;
        }
        
        /* Chart Container Rules */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        @media (max-width: 640px) {
            .chart-container {
                height: 300px;
            }
        }
        
        .section-title {
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 60px;
            height: 4px;
            background-color: #F97316;
            border-radius: 2px;
        }

        /* Hover Effects for Clickable Elements */
        .cursor-pointer:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }

        /* Modal Animation */
        #infoModal {
            transition: opacity 0.3s ease;
        }
        #infoModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #infoModal:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
        }

        /* Custom Scrollbar for Modal List */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header / Hero Section -->
    <header class="bg-gradient-to-r from-teal-800 to-sky-700 text-white py-12 px-4 shadow-lg">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-4 tracking-tight">
                <i class="fa-solid fa-notes-medical mr-3"></i>Laporan Data Kestradis Mimika 2025
            </h1>
            <p class="text-teal-100 text-lg md:text-xl max-w-2xl mx-auto">
                Analisis komprehensif ekosistem kesehatan tradisional: Praktisi (Hattra), Spa, Salon, & Kesiapan Puskesmas.
            </p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-10 space-y-16">

        <!-- Section 1: Executive Summary (Big Numbers) -->
        <section>
            <div class="mb-8 flex items-center">
                <i class="fa-solid fa-chart-pie text-orange-500 text-2xl mr-3"></i>
                <div>
                    <h2 class="text-2xl font-bold text-teal-900 section-title">Gambaran Umum Ekosistem</h2>
                    <p class="text-gray-600 mt-2 text-sm">Klik pada kartu untuk melihat daftar nama lengkap.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Card 1: Hattra -->
                <div onclick="openModalFromCard('hattra')" class="cursor-pointer bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500 hover:shadow-xl transition duration-300">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Total Hattra</div>
                            <div class="text-4xl font-bold text-gray-800 mt-2">22</div>
                            <div class="text-xs text-orange-600 font-medium mt-1">Praktisi Terdaftar</div>
                        </div>
                        <i class="fa-solid fa-hands-holding-circle text-orange-200 text-4xl"></i>
                    </div>
                </div>

                <!-- Card 2: Spa & Salon -->
                <div onclick="openModalFromCard('spa')" class="cursor-pointer bg-white rounded-xl shadow-md p-6 border-l-4 border-teal-500 hover:shadow-xl transition duration-300">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Spa & Salon</div>
                            <div class="text-4xl font-bold text-gray-800 mt-2">13</div>
                            <div class="text-xs text-teal-600 font-medium mt-1">Unit Usaha</div>
                        </div>
                        <i class="fa-solid fa-spa text-teal-200 text-4xl"></i>
                    </div>
                </div>

                <!-- Card 3: Jamu -->
                <div onclick="openModalFromCard('jamu')" class="cursor-pointer bg-white rounded-xl shadow-md p-6 border-l-4 border-sky-500 hover:shadow-xl transition duration-300">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Toko Jamu/Herbal</div>
                            <div class="text-4xl font-bold text-gray-800 mt-2">26</div>
                            <div class="text-xs text-sky-600 font-medium mt-1">Outlet Distribusi</div>
                        </div>
                        <i class="fa-solid fa-leaf text-sky-200 text-4xl"></i>
                    </div>
                </div>

                <!-- Card 4: Puskesmas -->
                <div onclick="openModalFromCard('puskesmas')" class="cursor-pointer bg-white rounded-xl shadow-md p-6 border-l-4 border-indigo-500 hover:shadow-xl transition duration-300">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Puskesmas</div>
                            <div class="text-4xl font-bold text-gray-800 mt-2">26</div>
                            <div class="text-xs text-indigo-600 font-medium mt-1">Fasilitas Kesehatan</div>
                        </div>
                        <i class="fa-solid fa-hospital-user text-indigo-200 text-4xl"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Hattra Analysis (Charts) -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
            <!-- Left Column: Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6 relative">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa-solid fa-users-viewfinder text-teal-600 mr-3"></i>
                    Komposisi Penyehat Tradisional
                </h3>
                <div class="chart-container">
                    <canvas id="hattraTypeChart"></canvas>
                </div>
                <div class="mt-4 text-center text-xs text-gray-500 bg-gray-50 p-2 rounded border border-gray-100">
                    <i class="fa-solid fa-hand-pointer mr-1"></i>
                    Klik pada bagian chart untuk melihat nama praktisi.
                </div>
            </div>

            <!-- Right Column: Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa-solid fa-file-signature text-orange-500 mr-3"></i>
                    Status Perizinan (NIB)
                </h3>
                <div class="chart-container">
                    <canvas id="hattraNibChart"></canvas>
                </div>
                <div class="mt-4 text-center text-xs text-gray-500 bg-gray-50 p-2 rounded border border-gray-100">
                    <i class="fa-solid fa-hand-pointer mr-1"></i>
                    Klik pada batang grafik untuk melihat detail nama.
                </div>
            </div>
        </section>

        <!-- Section 3: Commercial Sector (Mixed Layout) -->
        <section>
            <div class="mb-6 flex items-center">
                <i class="fa-solid fa-shop text-teal-700 text-2xl mr-3"></i>
                <div>
                    <h2 class="text-2xl font-bold text-teal-900 section-title mb-2">Sektor Komersial</h2>
                    <p class="text-gray-600 mt-1 text-sm">Perbandingan kepatuhan administrasi Spa, Salon, dan Depot Jamu.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Spa & Salon Breakdown (Interactive Custom Bar) -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden flex flex-col h-full">
                    <div class="bg-teal-700 px-6 py-4 flex justify-between items-center">
                        <h3 class="text-white font-bold text-lg"><i class="fa-solid fa-check-double mr-2"></i>Kepatuhan Spa & Salon</h3>
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-center">
                         <!-- Interactive Bars -->
                        <div class="space-y-6">
                            <!-- Item 1: Ada NIB -->
                            <div class="group cursor-pointer" onclick="openModalGeneric('Spa & Salon: Memiliki NIB', db.spa_ada_nib)">
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700 flex items-center">
                                        <i class="fa-solid fa-circle-check text-teal-500 mr-2"></i>Memiliki NIB
                                    </span>
                                    <span class="text-sm font-bold text-teal-700">61.5% (8 Unit)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden">
                                    <div class="bg-teal-500 h-full rounded-full transition-all duration-500 group-hover:bg-teal-600" style="width: 61.5%"></div>
                                </div>
                                <p class="text-xs text-teal-600 mt-1 italic group-hover:font-bold">
                                    <i class="fa-solid fa-eye mr-1"></i>Klik untuk lihat nama
                                </p>
                            </div>
                            <!-- Item 2: Tidak Ada NIB -->
                            <div class="group cursor-pointer" onclick="openModalGeneric('Spa & Salon: TIDAK Ada NIB', db.spa_no_nib)">
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700 flex items-center">
                                        <i class="fa-solid fa-circle-xmark text-orange-500 mr-2"></i>Tidak Ada NIB
                                    </span>
                                    <span class="text-sm font-bold text-orange-600">38.5% (5 Unit)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden">
                                    <div class="bg-orange-500 h-full rounded-full transition-all duration-500 group-hover:bg-orange-600" style="width: 38.5%"></div>
                                </div>
                                <p class="text-xs text-orange-600 mt-1 italic group-hover:font-bold">
                                    <i class="fa-solid fa-eye mr-1"></i>Klik untuk lihat nama
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Jamu & Herbal Chart -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                        <i class="fa-solid fa-prescription-bottle-medical text-sky-600 mr-2"></i>
                        Distribusi & Izin Toko Herbal
                    </h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="jamuChart"></canvas>
                    </div>
                    <div class="mt-2 text-center text-xs text-gray-500">
                        <i class="fa-solid fa-hand-pointer mr-1"></i>Klik chart untuk detail toko
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Puskesmas Infrastructure -->
        <section class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div class="flex items-start">
                    <i class="fa-solid fa-hospital text-indigo-600 text-3xl mr-4 mt-1"></i>
                    <div>
                        <h2 class="text-2xl font-bold text-teal-900 section-title mb-2">Kesiapan Fasilitas Puskesmas</h2>
                        <p class="text-gray-600 mt-2 text-sm">
                            Klik grafik untuk melihat Puskesmas yang <strong class="text-red-500">BELUM</strong> memiliki fasilitas.
                        </p>
                    </div>
                </div>
                <div class="mt-4 md:mt-0 bg-teal-50 px-5 py-3 rounded-lg border border-teal-100">
                    <div class="flex items-center justify-center mb-1">
                        <i class="fa-solid fa-trophy text-yellow-500 mr-2"></i>
                        <span class="text-xs text-teal-600 uppercase font-bold tracking-wider">Top Performance</span>
                    </div>
                    <span class="block text-xl font-bold text-teal-800 text-center">PKM Timika Jaya</span>
                </div>
            </div>

            <div class="chart-container" style="max-width: 800px; height: 400px;">
                <canvas id="puskesmasChart"></canvas>
            </div>
            
            <!-- Cards for Puskesmas Stats (Clickable) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                <!-- Card 1 -->
                <div onclick="openModalGeneric('Puskesmas: Ada Ruang Hattra', db.pkm_ada_hattra)" class="cursor-pointer bg-gray-50 p-4 rounded-lg text-center hover:bg-teal-100 transition border border-transparent hover:border-teal-300">
                    <i class="fa-solid fa-door-open text-teal-600 text-2xl mb-2"></i>
                    <div class="text-3xl font-bold text-teal-600">23%</div>
                    <div class="text-xs font-semibold text-gray-500 uppercase mt-1">Memiliki Ruang Hattra</div>
                    <div class="text-[10px] text-gray-400 mt-2">Klik untuk lihat nama PKM</div>
                </div>
                <!-- Card 2 -->
                <div onclick="openModalGeneric('Puskesmas: Memiliki TOGA', db.pkm_ada_toga)" class="cursor-pointer bg-gray-50 p-4 rounded-lg text-center hover:bg-orange-100 transition border border-transparent hover:border-orange-300">
                    <i class="fa-solid fa-seedling text-orange-500 text-2xl mb-2"></i>
                    <div class="text-3xl font-bold text-orange-500">46%</div>
                    <div class="text-xs font-semibold text-gray-500 uppercase mt-1">Memiliki Toga</div>
                    <div class="text-[10px] text-gray-400 mt-2">Klik untuk lihat nama PKM</div>
                </div>
                <!-- Card 3 -->
                <div onclick="openModalGeneric('Puskesmas: Program GERMIJA', db.pkm_ada_germija)" class="cursor-pointer bg-gray-50 p-4 rounded-lg text-center hover:bg-sky-100 transition border border-transparent hover:border-sky-300">
                    <i class="fa-solid fa-person-running text-sky-600 text-2xl mb-2"></i>
                    <div class="text-3xl font-bold text-sky-600">42%</div>
                    <div class="text-xs font-semibold text-gray-500 uppercase mt-1">Program Germija</div>
                    <div class="text-[10px] text-gray-400 mt-2">Klik untuk lihat nama PKM</div>
                </div>
            </div>
        </section>

        <!-- Section 5: Human Resources & Conclusion -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <!-- SDM Card -->
            <div class="relative bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl shadow-lg p-8 text-white overflow-hidden">
                <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-white opacity-5"></div>
                
                <h3 class="text-xl font-bold mb-6 border-b border-slate-600 pb-2 flex items-center">
                    <i class="fa-solid fa-user-doctor mr-3 text-teal-400"></i>SDM Kesehatan Terlatih
                </h3>
                
                <div class="flex items-center mb-6">
                    <div class="w-16 h-16 rounded-full bg-orange-500 flex items-center justify-center text-2xl font-bold mr-4 shadow-lg">
                        3
                    </div>
                    <div>
                        <p class="text-lg font-semibold">Total Tenaga</p>
                        <p class="text-slate-400 text-sm">Pelatihan Akupressur</p>
                    </div>
                </div>

                <ul class="space-y-4 text-sm text-slate-300">
                    <li class="flex items-start bg-slate-800 p-2 rounded hover:bg-slate-700 transition cursor-default">
                        <i class="fa-solid fa-stethoscope text-orange-400 mt-1 mr-3"></i>
                        <div>
                            <strong class="text-white">dr. Suzan Namza</strong>
                            <div class="text-xs text-slate-400">Puskesmas Timika Jaya (Pelayanan Dobel)</div>
                        </div>
                    </li>
                    <li class="flex items-start bg-slate-800 p-2 rounded hover:bg-slate-700 transition cursor-default">
                        <i class="fa-solid fa-user-nurse text-orange-400 mt-1 mr-3"></i>
                        <div>
                            <strong class="text-white">Kurniati, AKL</strong>
                            <div class="text-xs text-slate-400">Puskesmas Wania (PJ Dobel)</div>
                        </div>
                    </li>
                    <li class="flex items-start bg-slate-800 p-2 rounded hover:bg-slate-700 transition cursor-default">
                        <i class="fa-solid fa-user-nurse text-teal-400 mt-1 mr-3"></i>
                        <div>
                            <strong class="text-white">Ropana Wasarea, AMK</strong>
                            <div class="text-xs text-slate-400">Puskesmas Jile Ale (Aktif)</div>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Recommendation Card -->
            <div class="bg-teal-50 rounded-xl p-8 border border-teal-100 flex flex-col justify-center relative">
                <i class="fa-solid fa-quote-right absolute top-6 right-6 text-teal-200 text-6xl opacity-50"></i>
                <h3 class="text-xl font-bold text-teal-900 mb-4 flex items-center">
                    <i class="fa-solid fa-clipboard-check mr-2"></i>Rekomendasi Strategis
                </h3>
                <p class="text-gray-700 mb-6 text-sm leading-relaxed relative z-10">
                    Berdasarkan gap analisis data tahun 2025, berikut adalah langkah prioritas yang disarankan:
                </p>
                <div class="space-y-4 relative z-10">
                    <div class="flex items-start text-sm text-gray-800 bg-white p-3 rounded shadow-sm">
                        <div class="min-w-[24px] h-6 rounded-full bg-teal-200 text-teal-800 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</div>
                        <span>Peningkatan <strong>sosialisasi NIB</strong> secara intensif kepada praktisi Pijat & Bekam yang memiliki tingkat kepatuhan terendah.</span>
                    </div>
                    <div class="flex items-start text-sm text-gray-800 bg-white p-3 rounded shadow-sm">
                        <div class="min-w-[24px] h-6 rounded-full bg-teal-200 text-teal-800 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</div>
                        <span>Re-aktivasi program <strong>Asman (Asuhan Mandiri)</strong> di Puskesmas, yang saat ini hanya ada di 2 lokasi.</span>
                    </div>
                    <div class="flex items-start text-sm text-gray-800 bg-white p-3 rounded shadow-sm">
                        <div class="min-w-[24px] h-6 rounded-full bg-teal-200 text-teal-800 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</div>
                        <span>Penambahan kuota <strong>Pelatihan Nakes</strong> agar tidak terjadi beban ganda (Double Job) pada petugas yang ada.</span>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-8 text-center text-sm border-t-4 border-teal-600">
        <p class="mb-2"><i class="fa-solid fa-building-columns mr-2"></i>Dinas Kesehatan Kabupaten Mimika</p>
        <p>Â© 2025 Laporan Kestradis - Visualisasi Data</p>
    </footer>

    <!-- MODAL STRUCTURE -->
    <div id="infoModal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" onclick="closeModal()"></div>

        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <!-- Modal Panel -->
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-teal-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fa-solid fa-list-ul text-teal-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                            <h3 class="text-lg font-semibold leading-6 text-gray-900" id="modal-title">Data Detail</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 mb-2" id="modal-subtitle">Daftar nama terkait:</p>
                                <div id="modal-content" class="text-sm text-gray-700 max-h-60 overflow-y-auto custom-scroll bg-gray-50 p-3 rounded-md border border-gray-200">
                                    <!-- Dynamic Content Here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" class="inline-flex w-full justify-center rounded-md bg-teal-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500 sm:ml-3 sm:w-auto" onclick="closeModal()">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT SECTION -->
    <script>
        // --- 1. DATA DATABASE (Extracted from Report) ---
        const db = {
            // HATTRA TYPES
            hattra_akupressur: ["Bpk N. Mustofa M (Akupressur Saraf)", "Bpk Marzuki (Ahli Pijat Saraf)"],
            hattra_pijat: ["Ibu Rustiana", "Bpk Pancar", "Bpk Agus Subandi", "Bpk Rawi", "Bpk La Ode Malik", "Bude Irep", "Bpk Wahid", "Bpk Subandi", "Mbak Opik", "Pakde Nawi", "Bpk Rendra Tourish"],
            hattra_bekam: ["Indra", "Oscar", "Cak Rijal Bekam", "Alimudin"],
            hattra_refleksi: ["Abdurasyid", "Bpk Agung", "Ibu Agustina Belapo", "Yuilanti", "Mustakdir Djafar"],
            
            // HATTRA NIB
            hattra_nib_ada_akupressur: ["Bpk N. Mustofa M", "Bpk Marzuki"],
            hattra_nib_no_akupressur: [],
            hattra_nib_ada_pijat: ["Ibu Rustiana", "Bpk Pancar", "Bpk Agus Subandi"],
            hattra_nib_no_pijat: ["Bpk Rawi", "Bpk La Ode Malik", "Bude Irep", "Bpk Wahid", "Bpk Subandi", "Mbak Opik", "Pakde Nawi", "Bpk Rendra Tourish"],
            hattra_nib_ada_bekam: [],
            hattra_nib_no_bekam: ["Indra", "Oscar", "Cak Rijal Bekam", "Alimudin"],
            hattra_nib_ada_refleksi: ["Bpk Agung", "Ibu Agustina Belapo", "Yuilanti"],
            hattra_nib_no_refleksi: ["Abdurasyid", "Mustakdir Djafar"],

            // SPA & SALON
            spa_ada_nib: ["Melli (Spa Nomi)", "Sintia (Spa Grand Tembaga)", "Diana (Spa Aldy's)", "Teguh (Spa Olin)", "Dewanta (Spa Luxury)", "Yanti (Spa Yanti)", "Elsina Batu Muly", "Miing Sundari (Timika Barbershop)"],
            spa_no_nib: ["Puspita Sari (Spa Willis)", "Rahayu Ningsih (Spa Maleo)", "Iryani Maya (Spa Akasia)", "Revani (Revani Salon)", "Anita (Salon Anita)"],

            // JAMU & HERBAL
            jamu_depot_ada: ["Depot Jamu Sumber Alam", "Jamu Barokah", "Aneka Jamu"],
            jamu_depot_no: ["Jamu Sehat", "Jamu Berkah"],
            jamu_herbal_ada: ["Tiongkok/Syifa Herbal", "Bintang Jaya", "Herbal Dennis", "Tauhid Herbal", "Sehat dgan Herbal", "Rumah Madu 1", "Medical Herbal", "Ramuan Herbal", "Distributor Tiens"],
            jamu_herbal_no: ["Rumah Madu 2", "Distributor HNI SP 2", "Herbal Madu El Fathan", "Toko SudifADEL", "Distributor HNI Yos Sudarso", "Minyak Daun Gatal", "Distributor HNI SP 4", "Rumah Sehat Madu", "Toko SR12 Herbal", "Agen Clorofil Timika", "Sub Stokist K-Link", "Distributor Infinical"],

            // PUSKESMAS (Missing Facilities - for the main bar chart)
            pkm_no_toga: ["Timika Jaya", "Mapurujaya", "Alama", "Kokonao", "Mapar", "Amar", "Ipaya", "Atuka", "Wakia", "Tapormai", "Agimuga", "Jila", "Hoya", "Tsinga"],
            pkm_no_germija: ["Mapurujaya", "Manasari", "Jita", "Arwanop", "Kokonao", "Mapar", "Amar", "Ipaya", "Atuka", "Wakia", "Tapormai", "Agimuga", "Jila", "Hoya", "Tsinga"],
            pkm_no_hattra: ["Pasar Sentral", "Wania", "Ayuka", "Mapurujaya", "Manasari", "Potowaiburu", "Jita", "Arwanop", "Alama", "Kokonao", "Mapar", "Amar", "Ipaya", "Atuka", "Wakia", "Tapormai", "Agimuga", "Jila", "Hoya", "Tsinga"],
            pkm_no_asman: ["Timika", "Pasar Sentral", "Timika Jaya", "Kwamki", "Karang Senang", "Bhintuka", "Limau Asri", "Wania", "Manasari", "Potowaiburu", "Jita", "Arwanop", "Alama", "Kokonao", "Mapar", "Amar", "Ipaya", "Atuka", "Wakia", "Tapormai", "Agimuga", "Jila", "Hoya", "Tsinga"],

            // PUSKESMAS (Having Facilities - for the percentage cards)
            pkm_ada_hattra: ["Timika", "Timika Jaya", "Kwamki", "Karang Senang", "Bhintuka", "Limau Asri"],
            pkm_ada_toga: ["Timika", "Pasar Sentral", "Kwamki", "Karang Senang", "Bhintuka", "Limau Asri", "Wania", "Ayuka", "Manasari", "Potowaiburu", "Jita", "Arwanop"],
            pkm_ada_germija: ["Timika", "Pasar Sentral", "Timika Jaya", "Kwamki", "Karang Senang", "Bhintuka", "Limau Asri", "Wania", "Ayuka", "Potowaiburu", "Alama"]
        };

        // --- 2. MODAL LOGIC ---
        function openModal(title, items) {
            document.getElementById('modal-title').innerText = title;
            const contentDiv = document.getElementById('modal-content');
            
            if (!items || items.length === 0) {
                contentDiv.innerHTML = '<div class="p-2 text-center italic text-gray-500">Tidak ada data terdaftar.</div>';
            } else {
                let html = '<ul class="divide-y divide-gray-200">';
                items.forEach(item => {
                    html += `<li class="py-2 flex items-start"><i class="fa-solid fa-angle-right text-teal-500 mt-1 mr-2 text-xs"></i><span>${item}</span></li>`;
                });
                html += '</ul>';
                contentDiv.innerHTML = html;
            }
            
            document.getElementById('infoModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('infoModal').classList.add('hidden');
        }

        function openModalGeneric(title, dataArray) {
            openModal(title, dataArray);
        }

        function openModalFromCard(type) {
            let title = "";
            let data = [];
            
            if (type === 'hattra') {
                title = "Daftar Semua Hattra (22)";
                data = [...db.hattra_akupressur, ...db.hattra_pijat, ...db.hattra_bekam, ...db.hattra_refleksi];
            } else if (type === 'spa') {
                title = "Daftar Spa & Salon (13)";
                data = [...db.spa_ada_nib, ...db.spa_no_nib];
            } else if (type === 'jamu') {
                title = "Daftar Jamu & Herbal (26)";
                data = [...db.jamu_depot_ada, ...db.jamu_depot_no, ...db.jamu_herbal_ada, ...db.jamu_herbal_no];
            } else if (type === 'puskesmas') {
                title = "Daftar Semua Puskesmas (26)";
                data = [
                    "Timika", "Pasar Sentral", "Timika Jaya", "Kwamki", "Karang Senang", "Bhintuka", "Limau Asri", 
                    "Wania", "Ayuka", "Mapurujaya", "Manasari", "Potowaiburu", "Jita", "Arwanop", "Alama", "Kokonao", 
                    "Mapar", "Amar", "Ipaya", "Atuka", "Wakia", "Tapormai", "Agimuga", "Jila", "Hoya", "Tsinga"
                ];
            }
            openModal(title, data);
        }

        // --- 3. CHART & INTERACTION LOGIC ---

        // Helper for labels
        function splitLabel(label, maxLength = 16) {
            if (label.length <= maxLength) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];
            for (let i = 1; i < words.length; i++) {
                if ((currentLine + " " + words[i]).length <= maxLength) {
                    currentLine += " " + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Chart 1: Hattra Types (Donut)
        const ctxHattraType = document.getElementById('hattraTypeChart').getContext('2d');
        const hattraTypeChart = new Chart(ctxHattraType, {
            type: 'doughnut',
            data: {
                labels: ['Pijat Tradisional', 'Refleksi', 'Bekam', 'Akupressur'],
                datasets: [{
                    data: [11, 5, 4, 2],
                    backgroundColor: ['#0F766E', '#0EA5E9', '#F97316', '#64748B']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } },
                onClick: (e, activeEls) => {
                    if (activeEls.length === 0) return;
                    const index = activeEls[0].index;
                    const label = hattraTypeChart.data.labels[index];
                    let data = [];
                    if (label === 'Pijat Tradisional') data = db.hattra_pijat;
                    else if (label === 'Refleksi') data = db.hattra_refleksi;
                    else if (label === 'Bekam') data = db.hattra_bekam;
                    else if (label === 'Akupressur') data = db.hattra_akupressur;
                    openModal(`Kategori: ${label}`, data);
                }
            }
        });

        // Chart 2: NIB Status (Bar)
        const ctxHattraNib = document.getElementById('hattraNibChart').getContext('2d');
        const hattraNibChart = new Chart(ctxHattraNib, {
            type: 'bar',
            data: {
                labels: ['Akupressur', 'Pijat Tradisional', 'Bekam', 'Refleksi'].map(l => splitLabel(l)),
                datasets: [
                    { label: 'Ada NIB', data: [2, 3, 0, 3], backgroundColor: '#10B981' },
                    { label: 'Tidak Ada NIB', data: [0, 8, 4, 2], backgroundColor: '#EF4444' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { stacked: false }, y: { beginAtZero: true } },
                onClick: (e, activeEls) => {
                    if (activeEls.length === 0) return;
                    const datasetIndex = activeEls[0].datasetIndex;
                    const index = activeEls[0].index;
                    const status = datasetIndex === 0 ? "Ada NIB" : "Tidak Ada NIB";
                    // Map original labels (before split)
                    const rawLabels = ['Akupressur', 'Pijat Tradisional', 'Bekam', 'Refleksi'];
                    const category = rawLabels[index];
                    
                    let data = [];
                    if (category === 'Akupressur') data = datasetIndex === 0 ? db.hattra_nib_ada_akupressur : db.hattra_nib_no_akupressur;
                    else if (category === 'Pijat Tradisional') data = datasetIndex === 0 ? db.hattra_nib_ada_pijat : db.hattra_nib_no_pijat;
                    else if (category === 'Bekam') data = datasetIndex === 0 ? db.hattra_nib_ada_bekam : db.hattra_nib_no_bekam;
                    else if (category === 'Refleksi') data = datasetIndex === 0 ? db.hattra_nib_ada_refleksi : db.hattra_nib_no_refleksi;

                    openModal(`${category} - ${status}`, data);
                }
            }
        });

        // Chart 3: Jamu (Pie)
        const ctxJamu = document.getElementById('jamuChart').getContext('2d');
        const jamuChart = new Chart(ctxJamu, {
            type: 'pie',
            data: {
                labels: ['Herbal (Ada NIB)', 'Herbal (No NIB)', 'Depot Jamu (Ada NIB)', 'Depot Jamu (No NIB)'].map(l => splitLabel(l, 20)),
                datasets: [{
                    data: [9, 12, 3, 2],
                    backgroundColor: ['#0EA5E9', '#94A3B8', '#0F766E', '#F97316']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'right', labels: { boxWidth: 12, font: { size: 10 } } } },
                onClick: (e, activeEls) => {
                    if (activeEls.length === 0) return;
                    const index = activeEls[0].index;
                    // Indexes: 0=Herbal Ada, 1=Herbal No, 2=Jamu Ada, 3=Jamu No
                    let title = "";
                    let data = [];
                    if (index === 0) { title = "Toko Herbal - Ada NIB"; data = db.jamu_herbal_ada; }
                    else if (index === 1) { title = "Toko Herbal - Tidak Ada NIB"; data = db.jamu_herbal_no; }
                    else if (index === 2) { title = "Depot Jamu - Ada NIB"; data = db.jamu_depot_ada; }
                    else if (index === 3) { title = "Depot Jamu - Tidak Ada NIB"; data = db.jamu_depot_no; }
                    
                    openModal(title, data);
                }
            }
        });

        // Chart 4: Puskesmas (Horizontal Bar) - Shows MISSING facilities
        const ctxPuskesmas = document.getElementById('puskesmasChart').getContext('2d');
        const puskesmasChart = new Chart(ctxPuskesmas, {
            type: 'bar',
            data: {
                labels: ['Memiliki Toga', 'Program Germija', 'Ruangan Hattra', 'Program Asman'].map(l => splitLabel(l, 20)),
                datasets: [{
                    label: 'Jumlah Puskesmas (Total 26)',
                    data: [12, 11, 6, 2],
                    backgroundColor: '#F97316',
                    borderRadius: 4
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { max: 26, beginAtZero: true } },
                plugins: {
                    tooltip: {
                        callbacks: {
                            footer: (items) => "Klik untuk lihat PKM yang TIDAK punya fasilitas ini."
                        }
                    }
                },
                onClick: (e, activeEls) => {
                    if (activeEls.length === 0) return;
                    const index = activeEls[0].index;
                    // Order: Toga, Germija, Hattra, Asman
                    let title = "";
                    let data = [];
                    if (index === 0) { title = "PKM TIDAK Ada Toga"; data = db.pkm_no_toga; }
                    else if (index === 1) { title = "PKM TIDAK Ada Germija"; data = db.pkm_no_germija; }
                    else if (index === 2) { title = "PKM TIDAK Ada Ruang Hattra"; data = db.pkm_no_hattra; }
                    else if (index === 3) { title = "PKM TIDAK Ada Asman"; data = db.pkm_no_asman; }

                    openModal(title, data);
                }
            }
        });
    </script>
</body>
</html>
